---
title: Types dâ€™environnements sous WordPress 5.5
description: Introduction Ã  la nouvelle fonction wp_get_environnement_type sur WordPress 5.5 pour gÃ¨rer son type d'environnement (development Ã  production)
excerpt: Introduction Ã  la nouvelle fonction wp_get_environnement_type() sur WordPress 5.5 nous permettant de savoir sur quel type dâ€™environnement on se trouve. TrÃ¨s pratique pour les dÃ©veloppeurs de thÃ¨mes ou de plugins dâ€™effectuer des tÃ¢ches prÃ©cises en fonction du type dâ€™environnement.
image: /images/blog/wordpress-environment-type.webp
date: "2020-08-15"
authors:
  - akiletour
---

<Callout>Introduction Ã  la nouvelle fonction `wp_get_environnement_type()` sur WordPress 5.5 nous permettant de savoir sur quel type dâ€™environnement on se trouve. TrÃ¨s pratique pour les dÃ©veloppeurs de thÃ¨mes ou de plugins dâ€™effectuer des tÃ¢ches prÃ©cises en fonction du type dâ€™environnement.</Callout>

<Image
  src="/images/blog/wordpress-5-5.webp"
  width="1024"
  height="498"
  alt="WordPress 5.5"
/>

Depuis que je suis dÃ©veloppeur Symfony, jâ€™ai du mal Ã  vivre sans cet Ã©cosystÃ¨me de type dâ€™environnements. Aujourdâ€™hui, WordPress vient de mâ€™offrir un petit cadeau avec lâ€™arrivÃ©e de la version 5.5. Une prise en charge complÃ¨te des environnements sous WordPress !

Je vais vous prÃ©senter dans cet article, la fonction `wp_get_environnement_type()` qui va nous permettre de rÃ©cupÃ©rer lâ€™environnement dans lequel on se trouve.

Par dÃ©faut, si aucun type dâ€™environnement est dÃ©fini, alors, ce dernier nous retourne Â« production Â».

Vous avez accÃ¨s nativement Ã  trois types dâ€™environnement :

- development : Lors de la phase de dÃ©veloppement ou dâ€™intÃ©gration
- staging : Pour tout ce qui est preprod, recette ou QA
- production : Votre site est en ligne ğŸ˜‰

Vous allez pouvoir en rajouter autant que vous le souhaitez. Nous verrons un peu plus bas comment rajouter un type dâ€™environnement test dans notre site.

Voici un exemple ci-dessous comment cette fonctionnalitÃ© peut Ãªtre utilisÃ©e pour dÃ©terminer le type dâ€™environnement sur lequel on se trouve :

```php
switch ( wp_get_environment_type() ) {
    case 'development':
        do_nothing();
        break;

    case 'staging':
        do_staging_thing();
        break;

    default:
        do_production_thing();
        break;
}
```

## DÃ©finir un type dâ€™environnement

Il y a [deux faÃ§ons](https://core.trac.wordpress.org/browser/trunk/src/wp-includes/load.php?rev=48662#L157) de dÃ©finir lâ€™environnement dans WordPress 5.5. Soit par les variables dâ€™environnement PHP `WP_ENVIRONMENT_TYPE` soit par les constants de WordPress (`define()`).

Peu importe la mÃ©thode que vous utilisez ci-dessus. Si celle-ci nâ€™est pas dans la liste des types dâ€™environnement autorisÃ©s, la valeur `production` sera utilisÃ©e.

Pour lâ€™exemple, nous allons voir comment dÃ©finir notre environnement au travers des constants de WordPress, on va Ã©diter le fichier `wp-config.php` Ã  la racine de notre projet :

```php
define('WP_ENVIRONMENT_TYPE', 'staging');
```

<div className="bg-orange text-white p-2">A noter : Si vous dÃ©finissez le type dâ€™environnement Ã  **development**, par dÃ©faut WordPress va basculer la constant `WP_DEBUG` a true. Si elle nâ€™est pas dÃ©jÃ  dÃ©finie dans le fichier wp-config.php</div>

## Comment ajouter un type dâ€™environnement Ã  WordPress

Au mÃªme titre que pour dÃ©finir votre type dâ€™environnement, vous avez la possibilitÃ© de dÃ©finir la liste des environnements autorisÃ©s au travers de la **variable dâ€™environnement** `WP_ENVIRONMENT_TYPES` (attention au â€œSâ€ Ã  la fin) ou par une **constant de WordPress**.

Disons que nous voulons rajouter lâ€™environnement test Ã  notre site. On va dÃ©finir la constant suivante :

```php
define(
    'WP_ENVIRONMENT_TYPES',
    array(
        'production',
        'staging',
        'development',
        'test',
    )
);
```

## Page accessible uniquement en dÃ©veloppement

Je vous avais parlÃ© de Bedrock et Sage pour [gÃ©nÃ©rer une URL personnalisÃ©e selon lâ€™environnement](/blog/generer-url-wordpress-personnalisee-bedrock-sage/). Et maintenant, Ã§a arrive nativement sur WordPress ! Nous avons plus besoin de passer par Bedrock.

Je vais reprendre lâ€™exemple que jâ€™avais fait pour crÃ©er une page WordPress. Elle a pour but de lister tous les styles de notre thÃ¨me.

Je veux que cette page soit uniquement disponible pendant la phase de dÃ©veloppement. Inutile de montrer Ã§a Ã  mes visiteurs ou Ã  mon robot favoris ğŸ˜‰

```php
add_action(
    'init',
    function () {
        $url_path = trim(parse_url(add_query_arg(array()), PHP_URL_PATH), '/');
        if ($url_path === 'ui') {
            $load = locate_template('views/ui.blade.php');
            if ($load) {
                echo template($load);
                exit();
            }
        }
    }
);
```

Dans lâ€™Ã©tat actuel, tout le monde peut voir cette page, lâ€™idÃ©e va Ãªtre de vÃ©rifier que `wp_get_environment_type()` est bien dÃ©fini sur `development` :

```php
/**
 * Add an UI board only for development environnement type
 */
if (wp_get_environment_type() === 'development') {
    add_action(
        'init',
        function () {
            $url_path = trim(parse_url(add_query_arg(array()), PHP_URL_PATH), '/');
            if ($url_path === 'ui') {
                $load = locate_template('views/ui.blade.php');
                if ($load) {
                    echo template($load);
                    exit();
                }
            }
        }
    );
}
```

Et hop ! Le tour est jouÃ©, cette nouvelle fonctionnalitÃ© de WordPress nous offre une flexibilitÃ© lors de nos dÃ©veloppements de plugins ou de thÃ¨mes !

Et voilÃ , jâ€™espÃ¨re que toi, dÃ©veloppeur, tu es aussi ravi que nous avec lâ€™arrivÃ©e de wp_get_environment_type() ğŸ™‚
